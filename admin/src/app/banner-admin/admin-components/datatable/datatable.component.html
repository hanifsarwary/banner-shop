<div class="mat-elevation-z8">
    <div class="datatable-container">
        <table mat-table [dataSource]="sourceData" [class.no-border]="borderedRows" [class.apply-borders]="tableBorder" multiTemplateDataRows matSort class="data-table">

            <ng-container matColumnDef="no">
                <th mat-header-cell *matHeaderCellDef> No </th>
                <td mat-cell *matCellDef="let element; let i = index"> {{sourceData.filteredData.indexOf(element)+1}} </td>
            </ng-container>

            <ng-container matColumnDef="work_order">
                <th mat-header-cell *matHeaderCellDef> Work Order </th>
                <td mat-cell *matCellDef="let element">{{element.job_number}}</td>
            </ng-container>

            <ng-container matColumnDef="invoice_no">
                <th mat-header-cell *matHeaderCellDef> Invoice # </th>
                <td mat-cell *matCellDef="let element">
                    <a href="javascript:;" (click)="openInvoiceModal(Invoice, element.id, element?.invoice)">TBD</a>
                </td>
            </ng-container>

            <ng-container matColumnDef="po_ref_no">
                <th mat-header-cell *matHeaderCellDef> PO/Ref # </th>
                <td mat-cell *matCellDef="let element">{{element.reference_number}}</td>
            </ng-container>

            <ng-container matColumnDef="job_name">
                <th mat-header-cell *matHeaderCellDef> Job Name </th>
                <td mat-cell *matCellDef="let element">{{element.custom_job_name}}</td>
            </ng-container>

            <ng-container matColumnDef="product_info">
                <th mat-header-cell *matHeaderCellDef> Product Info </th>
                <td mat-cell *matCellDef="let element">{{element?.custom_product_name}} <br> {{element?.custom_quantity}} <br> {{element?.ink_color}}</td>
            </ng-container>

            <ng-container matColumnDef="submitted_date">
                <th mat-header-cell *matHeaderCellDef> Submitted Date </th>
                <td mat-cell *matCellDef="let element">{{element.start_date}}</td>
            </ng-container>

            <ng-container matColumnDef="due_date">
                <th mat-header-cell *matHeaderCellDef> Due Date </th>
                <td mat-cell *matCellDef="let element">{{element.due_date}}</td>
            </ng-container>

            <ng-container matColumnDef="job_status">
                <th mat-header-cell *matHeaderCellDef> Job Status </th>
                <td mat-cell *matCellDef="let element">{{element.status}}</td>
            </ng-container>

            <ng-container matColumnDef="shipment_tracking">
                <th mat-header-cell *matHeaderCellDef> Shipment Tracking </th>
                <td mat-cell *matCellDef="let element"> </td>
            </ng-container>

            <ng-container matColumnDef="actual_ship_date">
                <th mat-header-cell *matHeaderCellDef> Actual Shipping Date </th>
                <td mat-cell *matCellDef="let element">{{element.due_date}}</td>
            </ng-container>

            <ng-container matColumnDef="company">
                <th mat-header-cell *matHeaderCellDef> Company </th>
                <td mat-cell *matCellDef="let element">{{element?.customer?.company_name}}</td>
            </ng-container>

            <ng-container matColumnDef="proof_status">
                <th mat-header-cell *matHeaderCellDef> Proof Status </th>
                <td mat-cell *matCellDef="let element">{{element.custom_proof}}</td>
            </ng-container>

            <ng-container matColumnDef="edit_order">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element">
                    <a href="javascript:;" (click)="openModal('add-category', element)">Edit Order</a>
                </td>
            </ng-container>

            <ng-container matColumnDef="payment">
                <th mat-header-cell *matHeaderCellDef> Payment </th>
                <td mat-cell *matCellDef="let element">{{element.quoted_price}}</td>
            </ng-container>

            <ng-container matColumnDef="placed_by">
                <th mat-header-cell *matHeaderCellDef> Placed By </th>
                <td mat-cell *matCellDef="let element">{{element?.added_by?.username}}</td>
            </ng-container>

            <ng-container matColumnDef="source">
                <th mat-header-cell *matHeaderCellDef> Source </th>
                <td mat-cell *matCellDef="let element"> </td>
            </ng-container>

            <ng-container matColumnDef="work_by">
                <th mat-header-cell *matHeaderCellDef> Worked By </th>
                <td mat-cell *matCellDef="let element"> </td>
            </ng-container>

            <ng-container matColumnDef="shipping_option">
                <th mat-header-cell *matHeaderCellDef> Shipping Options </th>
                <td mat-cell *matCellDef="let element"> </td>
            </ng-container>

            <ng-container matColumnDef="ship">
                <th mat-header-cell *matHeaderCellDef> Ship </th>
                <td mat-cell *matCellDef="let element"> </td>
            </ng-container>

            <ng-container matColumnDef="create_packing_list">
                <th mat-header-cell *matHeaderCellDef> Create Packing List </th>
                <td mat-cell *matCellDef="let element"> </td>
            </ng-container>

            <!-- Option Columns -->

            <ng-container matColumnDef="option_name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
                <td mat-cell *matCellDef="let element"> {{element.option_name}} </td>
            </ng-container>

            <ng-container matColumnDef="price_unit">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Price Unit </th>
                <td mat-cell *matCellDef="let element"> {{element.price_unit}} </td>
            </ng-container>

            <ng-container matColumnDef="option_description">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Description </th>
                <td mat-cell *matCellDef="let element"> {{element.option_description}} </td>
            </ng-container>

            <ng-container matColumnDef="option_type">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Type </th>
                <td mat-cell *matCellDef="let element"> {{element.option_type | optionTypes}} </td>
            </ng-container>

            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
                <td mat-cell *matCellDef="let element"> {{element.name}} </td>
            </ng-container>

            <ng-container matColumnDef="cat_image">
                <th mat-header-cell *matHeaderCellDef> Image </th>
                <td mat-cell *matCellDef="let element">
                    <div>
                        <img [src]="utils.getImage(element.default_category_image)" class="category-img" alt="">
                    </div>
                </td>
            </ng-container>

            <ng-container matColumnDef="product_name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
                <td mat-cell *matCellDef="let element"> {{element.product_name}} </td>
            </ng-container>

            <ng-container matColumnDef="product_price_type">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Price Type </th>
                <td mat-cell *matCellDef="let element"> {{element.price_type | priceType}} </td>
            </ng-container>

            <ng-container matColumnDef="product_image">
                <th mat-header-cell *matHeaderCellDef> Image </th>
                <td mat-cell *matCellDef="let element">
                    <div>
                        <img [src]="utils.getImage(element.default_product_image)" class="category-img" alt="">
                    </div>
                </td>
            </ng-container>

            <ng-container matColumnDef="actions" class="text-right">
                <th mat-header-cell *matHeaderCellDef>Actions </th>
                <td mat-cell *matCellDef="let element">
                    <button class="btn btn-sm btn-danger" (click)="categoryEvent('delete', element.id)">delete</button>
                </td>
              </ng-container>

              <ng-container matColumnDef="product_detail" class="text-right">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element">
                    <a href="javascript:;" [routerLink]="['/product/', element.id]">See details</a>
                </td>
              </ng-container>

              <ng-container matColumnDef="option_detail" class="text-right">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element">
                    <a href="javascript:;" [routerLink]="['/option/', element.id]">See details</a>
                </td>
              </ng-container>

              <ng-container matColumnDef="category_detail" class="text-right">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element">
                    <a href="javascript:;" [routerLink]="['/category/', element.id]">See details</a>
                </td>
              </ng-container>

              <ng-container matColumnDef="down_arrow" class="text-right">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element" class="example-element-row" 
                [class.example-expanded-row]="expandedElement === element"
                (click)="expandedElement = expandedElement === element ? null : element"
                (click)="expandDetail(element.id)">
                    <i *ngIf="!expandedElement || element.id != currentId" class="fa fa-angle-down"></i>
                    <i *ngIf="expandedElement && element.id === currentId" class="fa fa-angle-up"></i>
                </td>
              </ng-container>

              <ng-container matColumnDef="expandedDetail">
                <td mat-cell *matCellDef="let element" [attr.colspan]="datatableColumns.length">
                  <div *ngIf="optionExpand" class="example-element-detail" 
                  [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                    <div class="option-detail">
                        <div *ngIf="detailObj.length">
                            <h5>Sub Option</h5>
                            <table class="table table-fixed mat-elevation-z8" align="center">
                                <thead>
                                    <tr>
                                        <th class="col-6">Sub Option Name</th>
                                        <th class="col-6">Price </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let item of detailObj">
                                        <td class="col-6">{{item?.name}}</td>
                                        <td class="col-6">{{item?.price}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="small-loader" *ngIf="!optionLoading">
                            <div class="loading"  [class.d-block]="optionLoading"></div>
                        </div>
                        <div *ngIf="noOption" class="d-flex justify-content-center">
                            No Sub Option
                        </div>
                    </div>
                  </div>
                  <div *ngIf="productExpand" class="example-element-detail" 
                  [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                    <div class="option-detail">
                        <div *ngIf="detailObj.length">
                            <h5>Product Options</h5>
                            <table class="table table-fixed mat-elevation-z8" align="center">
                                <thead>
                                    <tr>
                                        <th class="col-6">Option Name</th>
                                        <th class="col-6">Option Type</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let item of detailObj">
                                        <td class="col-6">{{item?.option_name}}</td>
                                        <td class="col-6">{{item?.option_type | optionTypes}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div *ngIf="!optionLoading">
                            <div [class.loading]="productExpand" [class.d-block]="optionLoading"></div>
                        </div>
                        <div *ngIf="noOption" class="d-flex justify-content-center">
                            No Option
                        </div>
                    </div>
                  </div>
                  <div *ngIf="categoryExpand" class="example-element-detail" 
                  [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                    <div class="option-detail">
                        <div *ngIf="detailObj.length">
                            <h5>Sub Category</h5>
                            <table class="table table-fixed mat-elevation-z8" align="center">
                                <thead>
                                    <tr>
                                        <th class="col-6">Name</th>
                                        <th class="col-6">Imgage</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let item of detailObj">
                                        <td class="col-6">{{item?.name}}</td>
                                        <td class="col-6">
                                            <div>
                                                <img [src]="utils.getImage(element.default_category_image)" class="sub-category-img" alt="">
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="small-loader" *ngIf="!optionLoading">
                            <div class="loading"  [class.d-block]="optionLoading"></div>
                        </div>
                        <div *ngIf="noOption" class="d-flex justify-content-center">
                                No Sub Category
                        </div>
                    </div>
                  </div>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="datatableColumns"></tr>
              <tr mat-row *matRowDef="let element; columns: datatableColumns;">
              </tr>
              <tr style="border: none !important;" mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>

        </table>
    </div>
    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" showFirstLastButtons></mat-paginator>
</div>


<ng-template #Invoice let-modal>
    <div class="modal-header">
     <h5 class="modal-title" id="invoice">Invoice</h5>
     <button type="button" class="close" (click)="modal.dismiss()" aria-label="Close">
      <span aria-hidden="true">&times;</span>
     </button>
    </div>
    <div class="modal-body">
      <div class="invoiceForm">
          <form [formGroup]="invoiceForm" class="m-3 mr-4" (ngSubmit)="onSubmit(invoiceForm)">
            <div class="form-group row ml-0 mr-0">
                <label class="col-sm-2 col-form-label" for="authorization_code">Authorization code :</label>
                <input type="text" class="form-control col-sm-4" [ngModel]="invoiceObj ? invoiceObj.authorization_code : ''" formControlName="authorization_code" placeholder="Enter Authorization code">
            </div>
            <div class="form-group row ml-0 mr-0">
                <label class="col-sm-2 col-form-label" for="invoice_number">Invoice number :</label>
                <input type="number" class="form-control col-sm-4" [ngModel]="invoiceObj ? invoiceObj.invoice_number : ''" formControlName="invoice_number" placeholder="Enter Invoice number">
            </div>
            <div class="form-group row ml-0 mr-0">
                <label class="col-sm-2 col-form-label" for="paid_by">Paid By :</label>
                <input type="text" class="form-control col-sm-4" [ngModel]="invoiceObj ? invoiceObj.paid_by : ''" formControlName="paid_by" placeholder="Enter Paid By ">
            </div>
            <div class="form-group row ml-0 mr-0">
                <label class="col-sm-2 col-form-label" for="payment_method">Payment method :</label>
                <input type="text" class="form-control col-sm-4" [ngModel]="invoiceObj ? invoiceObj.payment_method : ''" formControlName="payment_method" placeholder="Enter Payment method">
            </div>
            <div class="form-group row ml-0 mr-0">
                <label class="col-sm-2 col-form-label" for="sold_to">Sold to :</label>
                <input type="text" class="form-control col-sm-4" [ngModel]="invoiceObj ? invoiceObj.sold_to : ''" formControlName="sold_to" placeholder="Enter Sold to">
            </div>
            <button class="btn btn-primary btn-submit mt-4 w-50" type="submit" [disabled]="invoiceForm.invalid"> Submit </button>
          </form>
      </div>
    </div>
   </ng-template>